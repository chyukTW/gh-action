name: caller

on: push

jobs:
  failed:
    runs-on: ubuntu-latest
    steps:
      - name: start
        id: start
        run: yarn start &> log_${{ github.run_id }}.txt

      - name: upload
        if: failure()
        uses: actions/upload-artifact@v3
        with:
          name: workflow_logs
          path: log_${{ github.run_id }}.txt
          if-no-files-found: error
          retention-days: 1

  summary:
    needs: failed
    if: ${{ always() && needs.failed.result != 'success' }}
    uses: ./.github/workflows/summary.yml

  after_summary:
    needs: summary
    runs-on: ubuntu-latest
    steps:
      - run: echo ${{ needs.summary.result }}

  notify:
    needs: failed
    if: ${{ always() && needs.failed.result != 'success' }}
    uses: ./.github/workflows/notify.yml

  after_notify:
    needs: notify
    runs-on: ubuntu-latest
    steps:
      - run: echo ${{ needs.notify.result }}

  call_cd:
    needs: failed
    if: needs.failed.result == 'success'
    runs-on: ubuntu-latest
    steps:
      - run: echo "call cd"
